<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenFeer.ai</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="description" content="GenFeer.ai 價格方案">
</head>
<body>
    <header>
        <div class="logo">
            <a href="https://genfeer-ai.web.app/">
                <img src="logo.png" alt="GenHorror.ai" class="logo-image">
            </a>
        </div>
        
        <button class="hamburger-menu" id="hamburgerMenu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        
        <nav class="nav-links" id="navLinks">
            <a href="https://genfeer-ai.web.app/" data-translate="首頁">首頁</a>
            <a href="https://genfeer-ai.web.app/#gallery" data-translate="畫廊">畫廊</a>
            
            <select class="language-select" id="language-select">
                <option value="en" data-text="English">🇺🇸 English</option>
                <option value="es" data-text="Español">🇪🇸 Español</option>
                <option value="de" data-text="Deutsch">🇩🇪 Deutsch</option>
                <option value="ja" data-text="日本語">🇯🇵 日本語</option>
                <option value="zh" data-text="中文" selected>🇨🇳 中文</option>
            </select>
            
            <button id="login-btn" class="btn-login" data-translate="登入">登入</button>
            <button id="pay-button" class="btn-premium" data-translate="升級方案">升級方案</button>

            <!-- 用戶信息將在這裡動態顯示 -->
        </nav>
    </header>

    

    <!-- Pricing Plans -->
    <section class="pricing-plans">
        <div class="container">
            <div class="pricing-grid">
                <!-- Free Plan -->
                <div class="pricing-card">
                    <div class="plan-name">
                        <h3 data-translate="免費">免費</h3>
                        <p data-translate="適合初次使用者">適合初次使用者</p>
                    </div>
                    <div class="plan-price">
                        <span class="price-amount">0</span>
                        <span class="price-currency">NT$</span>
                        <span class="price-period">/月</span>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li data-translate="每月 2 張圖片">每月 2 張圖片</li>
                            <li data-translate="低解析度">低解析度</li>
                            <li data-translate="有水印">有水印</li>
                        </ul>
                    </div>
                    <div class="plan-action">
                        <button class="btn-secondary" disabled data-translate="當前方案">當前方案</button>
                    </div>
                </div>

                <!-- Basic Plan -->
                <div class="pricing-card featured">
                    <div class="popular-badge" data-translate="最受歡迎">最受歡迎</div>
                    <div class="plan-name">
                        <h3 data-translate="基本">基本</h3>
                        <p data-translate="適合個人創作者">適合個人創作者</p>
                    </div>
                    <div class="plan-price">
                        <span class="price-amount">99</span>
                        <span class="price-currency">NT$</span>
                        <span class="price-period">/月</span>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li data-translate="每月 1000 張圖片">每月 1000 張圖片</li>
                            <li data-translate="中高解析度">中高解析度</li>
                            <li data-translate="無水印">無水印</li>
                        </ul>
                    </div>
                    <div class="plan-action">
                        <button class="btn-primary" onclick="subscribePlan('basic')" data-translate="開始使用">開始使用</button>
                    </div>
                </div>

                <!-- Advanced Plan -->
                <div class="pricing-card">
                    <div class="plan-name">
                        <h3 data-translate="進階">進階</h3>
                        <p data-translate="適合專業創作者">適合專業創作者</p>
                    </div>
                    <div class="plan-price">
                        <span class="price-amount">299</span>
                        <span class="price-currency">NT$</span>
                        <span class="price-period">/月</span>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li data-translate="無限生成">無限生成</li>
                            <li data-translate="自定義解析度">自定義解析度</li>
                            <li data-translate="無水印">無水印</li>
                        </ul>
                    </div>
                    <div class="plan-action">
                        <button class="btn-primary" onclick="subscribePlan('advanced')" data-translate="開始使用">開始使用</button>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Feature Comparison -->
    <section class="feature-comparison">
        <div class="container">
            <h2 data-translate="功能比較">功能比較</h2>
            <div class="comparison-wrapper">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th class="feature-column" data-translate="功能">功能</th>
                            <th class="plan-column" data-translate="免費">免費</th>
                            <th class="plan-column" data-translate="基本">基本</th>
                            <th class="plan-column" data-translate="進階">進階</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="feature-name" data-translate="每月生成數量">每月生成數量</td>
                            <td class="feature-value">2張</td>
                            <td class="feature-value">1000張</td>
                            <td class="feature-value" data-translate="無限">無限</td>
                        </tr>
                        <tr>
                            <td class="feature-name" data-translate="圖片解析度">圖片解析度</td>
                            <td class="feature-value" data-translate="低解析度">低解析度</td>
                            <td class="feature-value" data-translate="中高解析度">中高解析度</td>
                            <td class="feature-value" data-translate="自定義解析度">自定義解析度</td>
                        </tr>
                        <tr>
                            <td class="feature-name" data-translate="水印">水印</td>
                            <td class="feature-value" data-translate="有">有</td>
                            <td class="feature-value" data-translate="無">無</td>
                            <td class="feature-value" data-translate="無">無</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq-section">
        <div class="container">
            <h2 data-translate="常見問題">常見問題</h2>
            <div class="faq-grid">
                <div class="faq-item">
                    <h3 data-translate="可以隨時取消訂閱嗎？">可以隨時取消訂閱嗎？</h3>
                    <p data-translate="是的，您可以隨時在帳戶設定中取消訂閱，不會產生額外費用。">是的，您可以隨時在帳戶設定中取消訂閱，不會產生額外費用。</p>
                </div>
                <div class="faq-item">
                    <h3 data-translate="支援哪些付款方式？">支援哪些付款方式？</h3>
                    <p data-translate="我們支援信用卡、金融卡和 PayPal 等主要付款方式。">我們支援信用卡、金融卡和 PayPal 等主要付款方式。</p>
                </div>
                <div class="faq-item">
                    <h3 data-translate="生成的圖片可以商用嗎？">生成的圖片可以商用嗎？</h3>
                    <p data-translate="基本和進階方案支援個人使用，專業方案支援無限商業使用。">基本和進階方案支援個人使用，專業方案支援無限商業使用。</p>
                </div>
                <div class="faq-item">
                    <h3 data-translate="有免費試用期嗎？">有免費試用期嗎？</h3>
                    <p data-translate="所有付費方案都有 7 天免費試用期，無需信用卡即可開始。">所有付費方案都有 7 天免費試用期，無需信用卡即可開始。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 data-translate="GenHorror.ai">GenHorror.ai</h3>
                    <p data-translate="AI 驅動的恐怖圖片生成器">AI 驅動的恐怖圖片生成器</p>
                </div>
                <div class="footer-section">
                    <h4 data-translate="產品">產品</h4>
                    <ul>
                        <li><a href="#" data-translate="圖片生成">圖片生成</a></li>
                        <li><a href="#" data-translate="風格模板">風格模板</a></li>
                        <li><a href="#" data-translate="API">API</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 data-translate="支援">支援</h4>
                    <ul>
                        <li><a href="#" data-translate="幫助中心">幫助中心</a></li>
                        <li><a href="#" data-translate="聯絡我們">聯絡我們</a></li>
                        <li><a href="#" data-translate="隱私政策">隱私政策</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 GenHorror.ai. <span data-translate="版權所有">版權所有</span></p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="login-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 data-translate="登入">登入</h2>
            
            <!-- Email Login Form -->
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email" data-translate="電子郵件">電子郵件</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password" data-translate="密碼">密碼</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn-primary" data-translate="登入">登入</button>
            </form>
            
            <!-- Google Login -->
            <div class="google-login-section">
                <button id="google-login-btn" class="google-btn">
                    <i class="fab fa-google"></i>
                    <span data-translate="使用 Google 登入">使用 Google 登入</span>
                </button>
            </div>

            <!-- Switch to Signup -->
            <p class="auth-switch">
                <span data-translate="還沒有帳號？">還沒有帳號？</span>
                <a href="#" id="switch-to-signup" data-translate="立即註冊">立即註冊</a>
            </p>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signup-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 data-translate="註冊">註冊</h2>
            
            <!-- Email Signup Form -->
            <form id="signup-form">
                <div class="form-group">
                    <label for="signup-name" data-translate="姓名">姓名</label>
                    <input type="text" id="signup-name" required>
                </div>
                <div class="form-group">
                    <label for="signup-email" data-translate="電子郵件">電子郵件</label>
                    <input type="email" id="signup-email" required>
                </div>
                <div class="form-group">
                    <label for="signup-password" data-translate="密碼">密碼</label>
                    <input type="password" id="signup-password" required>
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password" data-translate="確認密碼">確認密碼</label>
                    <input type="password" id="signup-confirm-password" required>
                </div>
                <button type="submit" class="btn-primary" data-translate="註冊">註冊</button>
            </form>
            
            <!-- Google Signup -->
            <div class="google-login-section">
                <button id="google-signup-btn" class="google-btn">
                    <i class="fab fa-google"></i>
                    <span data-translate="使用 Google 註冊">使用 Google 註冊</span>
                </button>
            </div>

            <!-- Switch to Login -->
            <p class="auth-switch">
                <span data-translate="已有帳號？">已有帳號？</span>
                <a href="#" id="switch-to-login" data-translate="立即登入">立即登入</a>
            </p>
        </div>
    </div>

    <!-- Stripe -->
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        // Stripe 配置
        const stripe = Stripe('pk_test_51234567890abcdef');
        
        // 訂閱方案函數
        async function subscribePlan(planType) {
            try {
                console.log('開始訂閱方案:', planType);
                
                // 定義方案價格數據
                let priceData;
                switch(planType) {
                    case 'basic':
                        priceData = {
                            name: 'GenFeer.ai 基本方案',
                            description: '每月 NT$99，適合個人創作者',
                            unit_amount: 9900,
                            currency: 'twd'
                        };
                        break;
                    case 'advanced':
                        priceData = {
                            name: 'GenFeer.ai 進階方案',
                            description: '每月 NT$299，適合專業創作者',
                            unit_amount: 29900,
                            currency: 'twd'
                        };
                        break;
                    default:
                        throw new Error('無效的方案類型');
                }

                // 調用 Vercel API Route 創建 Stripe Checkout Session
                const response = await fetch('/api/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        plan: planType
                    })
                });

                if (!response.ok) {
                    throw new Error('API 請求失敗');
                }

                const result = await response.json();
                
                if (result.sessionId) {
                    // 重定向到 Stripe Checkout
                    const stripe = Stripe('pk_test_...'); // 使用您的 Stripe 公鑰
                    const { error } = await stripe.redirectToCheckout({
                        sessionId: result.sessionId
                    });
                    
                    if (error) {
                        throw new Error(error.message);
                    }
                } else {
                    throw new Error('無法獲取付款頁面連結');
                }
            } catch (error) {
                console.error('訂閱錯誤:', error);
                alert('訂閱失敗: ' + error.message);
            }
        }

        // 初始化頁面
        document.addEventListener('DOMContentLoaded', function() {
            console.log('付費頁面初始化完成');
        });
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script>
        // Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyAO9j3fqIuuwwf2znCBba1af7SW6Be7Tn4",
            authDomain: "genfeer-ai.firebaseapp.com",
            projectId: "genfeer-ai",
            storageBucket: "genfeer-ai.firebasestorage.app",
            messagingSenderId: "788596046031",
            appId: "1:788596046031:web:ff880f82c1d1d727bddfba",
            measurementId: "G-514SH5LEKK"
        };
        
        // 初始化 Firebase
        firebase.initializeApp(firebaseConfig);
        console.log('Firebase 初始化完成！');
        
        // 測試 Firebase Auth 是否可用
        console.log('Firebase Auth 可用:', !!firebase.auth);
        console.log('Firebase Auth 方法:', Object.keys(firebase.auth()));
        
        // 【重要】設置持久化 - 必須在初始化後立即設置
        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)
            .then(() => {
                console.log('✅ Firebase 持久化設置完成');
            })
            .catch((error) => {
                console.error('❌ Firebase 持久化設置失敗:', error);
            });
        
        // 【最重要】在任何 DOM 事件之前處理 redirect
        // 這確保 getRedirectResult 在頁面加載時立即檢查
        let redirectUser = null;
        
        firebase.auth().getRedirectResult()
            .then((result) => {
                console.log('✅ Redirect 檢查完成');
                if (result.user) {
                    console.log('⭐ 從 Google 重定向登入成功:', result.user.email);
                    redirectUser = result.user;
                    // 保存到全局變數供 script.js 使用
                    window.redirectUser = result.user;
                } else {
                    console.log('ℹ️ 沒有 redirect 用戶');
                }
            })
            .catch((error) => {
                console.error('❌ Redirect 檢查失敗:', error);
            });
    </script>

    <!-- 用戶面板模態框 -->
    <div id="user-panel-modal" class="modal hidden">
        <div class="user-panel-content">
            <span class="close">&times;</span>
            
            <!-- 用戶頭像和基本信息 -->
            <div class="user-header">
                <div class="user-avatar-section">
                    <img id="user-avatar" src="" alt="用戶頭像" class="user-avatar">
                    <div class="user-details">
                        <div class="user-name-section">
                            <span id="user-name" class="user-name"></span>
                            <button class="edit-btn" data-translate="修改">修改</button>
                        </div>
                        <div class="user-email-section">
                            <span id="user-email" class="user-email"></span>
                            <button class="edit-btn" data-translate="修改">修改</button>
                        </div>
                    </div>
                </div>
                <button id="buy-credits-btn" class="upgrade-btn" data-translate="升級方案">升級方案</button>
            </div>
            
            <!-- 分隔線 -->
            <div class="divider"></div>
            
            <!-- 方案信息 -->
            <div class="subscription-info">
                <div class="info-item">
                    <span class="info-label" data-translate="方案">方案</span>
                    <span id="current-plan" class="plan-badge">免費</span>
                </div>
                <div class="info-item">
                    <span class="info-label" data-translate="生成數量">生成數量</span>
                    <span id="generation-count" class="count-info">0/2</span>
                </div>
            </div>
            
            <!-- 分隔線 -->
            <div class="divider"></div>
            
            <!-- 用戶操作 -->
            <div class="user-actions">
                <button id="change-password-btn" class="action-btn" data-translate="修改密碼">修改密碼</button>
                <button id="delete-account-btn" class="action-btn danger" data-translate="刪除帳號">刪除帳號</button>
                <button id="logout-btn" class="action-btn logout" data-translate="登出">登出</button>
            </div>
        </div>
    </div>

    <script src="js/translations.js"></script>
    <script src="js/script-clean.js?v=1"></script>
</body>
</html>