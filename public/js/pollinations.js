// 1. functions/index.js: 
// const functions = require("firebase-functions");
// const stripe = require("stripe")("sk_test_51SI7Te2KKjbc3s12RAo0aO6LpMQg2X2q4j308FOtm3Drb9EwtpH6D1Rrg31fHKRRxiBhnOFn9EuLDdP1SaoBwAQY00JhTsEr0N");
// // const cors = require('cors')({ origin: true });
// const cors = require("cors")({
//   origin: ["https://genhorror-60.web.app"], // ✅ 只允許你的正式站
//   methods: ["POST", "OPTIONS"],              // ✅ 明確列出允許的方法
//   allowedHeaders: ["Content-Type"],          // ✅ 明確列出允許的標頭
// });

// exports.createCheckoutSession = functions.https.onRequest(async (req, res) => {
//   // 處理 CORS 預檢請求
//   if (req.method === 'OPTIONS') {
//     cors(req, res, () => {
//       res.status(200).send();
//     });
//     return;
//   }

//   // 啟用 CORS 並處理 POST 請求
//   cors(req, res, async () => {
//     if (req.method !== 'POST') {
//       return res.status(405).json({ error: 'Method Not Allowed' });
//     }

//     try {
//       console.log('Creating checkout session...');

//       const session = await stripe.checkout.sessions.create({
//         payment_method_types: ["card"],
//         mode: "payment",
//         line_items: [
//           {
//             price_data: {
//               currency: "usd",
//               product_data: {
//                 name: "Premium Plan",
//                 description: "升級為 Premium 會員，享受更多功能"
//               },
//               unit_amount: 500, // 5 USD
//             },
//             quantity: 1,
//           },
//         ],
//         success_url: "https://genhorror-60.web.app/success.html",
//         cancel_url: "https://genhorror-60.web.app/cancel.html",
//       });

//       console.log('Checkout session created:', session.id);
      
//       res.status(200).json({ 
//         url: session.url,
//         id: session.id
//       });
//     } catch (error) {
//       console.error('Error creating checkout session:', error);
//       res.status(500).json({ 
//         error: 'Internal Server Error',
//         message: error.message 
//       });
//     }
//   });
// });
// 2. firebase functions:log --only createCheckoutSession:
// 2025-10-14T14:07:49.071262923Z N createCheckoutSession: {"@type":"type.googleapis.com/google.cloud.audit.AuditLog","status":{},"authenticationInfo":{"principalEmail":"ormomax@gmail.com","principalSubject":"user:ormomax@gmail.com"},"requestMetadata":{"requestAttributes":{},"destinationAttributes":{}},"serviceName":"cloudfunctions.googleapis.com","methodName":"google.cloud.functions.v2.FunctionService.UpdateFunction","resourceName":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","response":{"serviceConfig":{"ingressSettings":"ALLOW_ALL","uri":"https://createcheckoutsession-4ttjamywha-uc.a.run.app","timeoutSeconds":60,"availableMemory":"256Mi","maxInstanceRequestConcurrency":80,"serviceAccountEmail":"1003552555411-compute@developer.gserviceaccount.com","revision":"createcheckoutsession-00002-qup","availableCpu":"1","maxInstanceCount":20,"allTrafficOnLatestRevision":true},"environment":"GEN_2","state":"ACTIVE","createTime":"2025-10-14T13:39:01.011989987Z","url":"https://us-central1-genhorror-60.cloudfunctions.net/createCheckoutSession","buildConfig":{"runtime":"nodejs22","dockerRegistry":"ARTIFACT_REGISTRY","source":{},"automaticUpdatePolicy":{},"dockerRepository":"projects/genhorror-60/locations/us-central1/repositories/gcf-artifacts","entryPoint":"createCheckoutSession","serviceAccount":"projects/genhorror-60/serviceAccounts/1003552555411-compute@developer.gserviceaccount.com"},"labels":{"deployment-tool":"cli-firebase","firebase-functions-hash":"7960431ee3cd62348bfaeb1327bf8c6c6bf50033"},"updateTime":"2025-10-14T14:06:41.948088548Z","@type":"type.googleapis.com/google.cloud.functions.v2.Function","satisfiesPzi":true,"name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession"},"resourceLocation":{"currentLocations":["us-central1"]}}
// 2025-10-14T14:09:18.192209Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-14T14:09:18.675538Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-14T14:33:41.481265Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-14T14:33:47.786704Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-14T22:36:23.589841Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-14T22:36:32.943001Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-14T22:42:57.303742Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-15T00:10:32.732662188Z N createCheckoutSession: {"@type":"type.googleapis.com/google.cloud.audit.AuditLog","authenticationInfo":{"principalEmail":"ormomax@gmail.com","principalSubject":"user:ormomax@gmail.com"},"requestMetadata":{"callerIp":"111.237.127.135","callerSuppliedUserAgent":"FirebaseCLI/14.19.1,gzip(gfe),gzip(gfe)","requestAttributes":{"time":"2025-10-15T00:10:31.777481383Z","auth":{}},"destinationAttributes":{}},"serviceName":"cloudfunctions.googleapis.com","methodName":"google.cloud.functions.v2.FunctionService.UpdateFunction","authorizationInfo":[{"resource":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","permission":"cloudfunctions.functions.update","granted":true,"resourceAttributes":{"service":"cloudfunctions.googleapis.com","name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","type":"cloudfunctions.googleapis.com/Function"},"permissionType":"ADMIN_WRITE"}],"resourceName":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","request":{"update_mask":{"paths":["name","build_config.runtime","build_config.entry_point","build_config.source.storage_source.bucket","build_config.source.storage_source.object","build_config.environment_variables","build_config.source_token","service_config.environment_variables","service_config.ingress_settings","service_config.timeout_seconds","service_config.service_account_email","service_config.available_memory","service_config.min_instance_count","service_config.max_instance_count","service_config.max_instance_request_concurrency","service_config.available_cpu","service_config.vpc_connector","service_config.vpc_connector_egress_settings","labels"]},"function":{"labels":{"deployment-tool":"cli-firebase","firebase-functions-hash":"3d13c621f0d7057999c3398bf74e17d4e08ba27e"},"service_config":{"max_instance_request_concurrency":80,"available_memory":"256Mi","available_cpu":"1"},"name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","build_config":{"source":{},"runtime":"nodejs22","entry_point":"createCheckoutSession"}},"@type":"type.googleapis.com/google.cloud.functions.v2.UpdateFunctionRequest"},"response":{"@type":"type.googleapis.com/google.longrunning.Operation"},"resourceLocation":{"currentLocations":["us-central1"]}}
// 2025-10-15T00:11:52.586592Z I createcheckoutsession: Starting new instance. Reason: DEPLOYMENT_ROLLOUT - Instance started due to traffic shifting between revisions due to deployment, traffic split adjustment, or deployment health check.
// 2025-10-15T00:11:55.375513Z I createcheckoutsession: Default STARTUP TCP probe succeeded after 1 attempt for container "worker" on port 8080.      
// 2025-10-15T00:11:57.095523387Z N createCheckoutSession: {"@type":"type.googleapis.com/google.cloud.audit.AuditLog","status":{},"authenticationInfo":{"principalEmail":"ormomax@gmail.com","principalSubject":"user:ormomax@gmail.com","oauthInfo":{"oauthClientId":"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com"}},"requestMetadata":{"requestAttributes":{},"destinationAttributes":{}},"serviceName":"cloudfunctions.googleapis.com","methodName":"google.cloud.functions.v2.FunctionService.UpdateFunction","resourceName":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","response":{"createTime":"2025-10-14T13:39:01.011989987Z","@type":"type.googleapis.com/google.cloud.functions.v2.Function","environment":"GEN_2","state":"ACTIVE","labels":{"firebase-functions-hash":"3d13c621f0d7057999c3398bf74e17d4e08ba27e","deployment-tool":"cli-firebase"},"url":"https://us-central1-genhorror-60.cloudfunctions.net/createCheckoutSession","serviceConfig":{"availableMemory":"256Mi","allTrafficOnLatestRevision":true,"availableCpu":"1","timeoutSeconds":60,"uri":"https://createcheckoutsession-4ttjamywha-uc.a.run.app","maxInstanceCount":20,"serviceAccountEmail":"1003552555411-compute@developer.gserviceaccount.com","ingressSettings":"ALLOW_ALL","maxInstanceRequestConcurrency":80,"revision":"createcheckoutsession-00003-xib"},"satisfiesPzi":true,"buildConfig":{"serviceAccount":"projects/genhorror-60/serviceAccounts/1003552555411-compute@developer.gserviceaccount.com","automaticUpdatePolicy":{},"dockerRegistry":"ARTIFACT_REGISTRY","source":{},"entryPoint":"createCheckoutSession","runtime":"nodejs22","dockerRepository":"projects/genhorror-60/locations/us-central1/repositories/gcf-artifacts"},"name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","updateTime":"2025-10-15T00:10:32.716546385Z"},"resourceLocation":{"currentLocations":["us-central1"]}}
// 2025-10-15T00:18:47.563339Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-15T00:19:36.745931Z I createcheckoutsession: Starting new instance. Reason: AUTOSCALING - Instance started due to configured scaling factors (e.g. CPU utilization, request throughput, etc.) or no existing capacity for current traffic.
// 2025-10-15T00:19:40.017730Z I createcheckoutsession: Default STARTUP TCP probe succeeded after 1 attempt for container "worker" on port 8080.      
// 2025-10-15T00:27:30.321600610Z N createCheckoutSession: {"@type":"type.googleapis.com/google.cloud.audit.AuditLog","authenticationInfo":{"principalEmail":"ormomax@gmail.com","principalSubject":"user:ormomax@gmail.com","oauthInfo":{"oauthClientId":"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com"}},"requestMetadata":{"callerIp":"111.237.127.135","callerSuppliedUserAgent":"FirebaseCLI/14.19.1,gzip(gfe),gzip(gfe)","requestAttributes":{"time":"2025-10-15T00:27:29.392113872Z","auth":{}},"destinationAttributes":{}},"serviceName":"cloudfunctions.googleapis.com","methodName":"google.cloud.functions.v2.FunctionService.UpdateFunction","authorizationInfo":[{"resource":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","permission":"cloudfunctions.functions.update","granted":true,"resourceAttributes":{"service":"cloudfunctions.googleapis.com","name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","type":"cloudfunctions.googleapis.com/Function"},"permissionType":"ADMIN_WRITE"}],"resourceName":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","request":{"@type":"type.googleapis.com/google.cloud.functions.v2.UpdateFunctionRequest","update_mask":{"paths":["name","build_config.runtime","build_config.entry_point","build_config.source.storage_source.bucket","build_config.source.storage_source.object","build_config.environment_variables","build_config.source_token","service_config.environment_variables","service_config.ingress_settings","service_config.timeout_seconds","service_config.service_account_email","service_config.available_memory","service_config.min_instance_count","service_config.max_instance_count","service_config.max_instance_request_concurrency","service_config.available_cpu","service_config.vpc_connector","service_config.vpc_connector_egress_settings","labels"]},"function":{"build_config":{"source":{},"runtime":"nodejs22","entry_point":"createCheckoutSession"},"name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","service_config":{"available_cpu":"1","available_memory":"256Mi","max_instance_request_concurrency":80},"labels":{"firebase-functions-hash":"4ab004b02a4d698732a9be515ab69a391ca2fdf9","deployment-tool":"cli-firebase"}}},"response":{"@type":"type.googleapis.com/google.longrunning.Operation"},"resourceLocation":{"currentLocations":["us-central1"]}}
// 2025-10-15T00:28:29.249072Z I createcheckoutsession: Starting new instance. Reason: DEPLOYMENT_ROLLOUT - Instance started due to traffic shifting between revisions due to deployment, traffic split adjustment, or deployment health check.
// 2025-10-15T00:28:31.126426Z I createcheckoutsession: Default STARTUP TCP probe succeeded after 1 attempt for container "worker" on port 8080.      
// 2025-10-15T00:28:32.879015673Z N createCheckoutSession: {"@type":"type.googleapis.com/google.cloud.audit.AuditLog","status":{},"authenticationInfo":{"principalEmail":"ormomax@gmail.com","principalSubject":"user:ormomax@gmail.com","oauthInfo":{"oauthClientId":"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com"}},"requestMetadata":{"requestAttributes":{},"destinationAttributes":{}},"serviceName":"cloudfunctions.googleapis.com","methodName":"google.cloud.functions.v2.FunctionService.UpdateFunction","resourceName":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","response":{"environment":"GEN_2","state":"ACTIVE","serviceConfig":{"ingressSettings":"ALLOW_ALL","availableMemory":"256Mi","timeoutSeconds":60,"availableCpu":"1","serviceAccountEmail":"1003552555411-compute@developer.gserviceaccount.com","maxInstanceCount":20,"uri":"https://createcheckoutsession-4ttjamywha-uc.a.run.app","allTrafficOnLatestRevision":true,"maxInstanceRequestConcurrency":80,"revision":"createcheckoutsession-00004-jip"},"labels":{"firebase-functions-hash":"4ab004b02a4d698732a9be515ab69a391ca2fdf9","deployment-tool":"cli-firebase"},"@type":"type.googleapis.com/google.cloud.functions.v2.Function","buildConfig":{"dockerRegistry":"ARTIFACT_REGISTRY","source":{},"entryPoint":"createCheckoutSession","runtime":"nodejs22","serviceAccount":"projects/genhorror-60/serviceAccounts/1003552555411-compute@developer.gserviceaccount.com","dockerRepository":"projects/genhorror-60/locations/us-central1/repositories/gcf-artifacts","automaticUpdatePolicy":{}},"updateTime":"2025-10-15T00:27:30.307994329Z","name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","url":"https://us-central1-genhorror-60.cloudfunctions.net/createCheckoutSession","createTime":"2025-10-14T13:39:01.011989987Z","satisfiesPzi":true},"resourceLocation":{"currentLocations":["us-central1"]}}
// 2025-10-15T00:29:11.817227Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-15T00:35:56.417352Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-15T00:42:51.699911726Z N createCheckoutSession: {"@type":"type.googleapis.com/google.cloud.audit.AuditLog","authenticationInfo":{"principalEmail":"ormomax@gmail.com","principalSubject":"user:ormomax@gmail.com"},"requestMetadata":{"callerIp":"111.237.127.135","callerSuppliedUserAgent":"FirebaseCLI/14.19.1,gzip(gfe),gzip(gfe)","requestAttributes":{"time":"2025-10-15T00:42:50.835836180Z","auth":{}},"destinationAttributes":{}},"serviceName":"cloudfunctions.googleapis.com","methodName":"google.cloud.functions.v2.FunctionService.UpdateFunction","authorizationInfo":[{"resource":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","permission":"cloudfunctions.functions.update","granted":true,"resourceAttributes":{"service":"cloudfunctions.googleapis.com","name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","type":"cloudfunctions.googleapis.com/Function"},"permissionType":"ADMIN_WRITE"}],"resourceName":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","request":{"update_mask":{"paths":["name","build_config.runtime","build_config.entry_point","build_config.source.storage_source.bucket","build_config.source.storage_source.object","build_config.environment_variables","build_config.source_token","service_config.environment_variables","service_config.ingress_settings","service_config.timeout_seconds","service_config.service_account_email","service_config.available_memory","service_config.min_instance_count","service_config.max_instance_count","service_config.max_instance_request_concurrency","service_config.available_cpu","service_config.vpc_connector","service_config.vpc_connector_egress_settings","labels"]},"@type":"type.googleapis.com/google.cloud.functions.v2.UpdateFunctionRequest","function":{"service_config":{"available_memory":"256Mi","available_cpu":"1","max_instance_request_concurrency":80},"labels":{"firebase-functions-hash":"9839b07ced08c26b815664cdb59712442f58c402","deployment-tool":"cli-firebase"},"build_config":{"entry_point":"createCheckoutSession","runtime":"nodejs22","source":{}},"name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession"}},"response":{"@type":"type.googleapis.com/google.longrunning.Operation"},"resourceLocation":{"currentLocations":["us-central1"]}}
// 2025-10-15T00:43:41.338196Z I createcheckoutsession: Starting new instance. Reason: DEPLOYMENT_ROLLOUT - Instance started due to traffic shifting between revisions due to deployment, traffic split adjustment, or deployment health check.
// 2025-10-15T00:43:43.673042Z I createcheckoutsession: Default STARTUP TCP probe succeeded after 1 attempt for container "worker" on port 8080.      
// 2025-10-15T00:43:48.789914867Z N createCheckoutSession: {"@type":"type.googleapis.com/google.cloud.audit.AuditLog","status":{},"authenticationInfo":{"principalEmail":"ormomax@gmail.com","principalSubject":"user:ormomax@gmail.com","oauthInfo":{"oauthClientId":"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com"}},"requestMetadata":{"requestAttributes":{},"destinationAttributes":{}},"serviceName":"cloudfunctions.googleapis.com","methodName":"google.cloud.functions.v2.FunctionService.UpdateFunction","resourceName":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","response":{"updateTime":"2025-10-15T00:42:51.684941402Z","@type":"type.googleapis.com/google.cloud.functions.v2.Function","environment":"GEN_2","state":"ACTIVE","createTime":"2025-10-14T13:39:01.011989987Z","satisfiesPzi":true,"buildConfig":{"dockerRepository":"projects/genhorror-60/locations/us-central1/repositories/gcf-artifacts","serviceAccount":"projects/genhorror-60/serviceAccounts/1003552555411-compute@developer.gserviceaccount.com","runtime":"nodejs22","dockerRegistry":"ARTIFACT_REGISTRY","entryPoint":"createCheckoutSession","source":{},"automaticUpdatePolicy":{}},"name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","labels":{"deployment-tool":"cli-firebase","firebase-functions-hash":"9839b07ced08c26b815664cdb59712442f58c402"},"url":"https://us-central1-genhorror-60.cloudfunctions.net/createCheckoutSession","serviceConfig":{"serviceAccountEmail":"1003552555411-compute@developer.gserviceaccount.com","ingressSettings":"ALLOW_ALL","availableCpu":"1","timeoutSeconds":60,"maxInstanceCount":20,"allTrafficOnLatestRevision":true,"availableMemory":"256Mi","maxInstanceRequestConcurrency":80,"uri":"https://createcheckoutsession-4ttjamywha-uc.a.run.app","revision":"createcheckoutsession-00005-ciw"}},"resourceLocation":{"currentLocations":["us-central1"]}}
// 2025-10-15T00:45:53.879987Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-15T00:45:54.353638Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-15T00:48:44.213882Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-15T00:49:00.135291Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-15T01:07:57.991840233Z N createCheckoutSession: {"@type":"type.googleapis.com/google.cloud.audit.AuditLog","authenticationInfo":{"principalEmail":"ormomax@gmail.com","principalSubject":"user:ormomax@gmail.com","oauthInfo":{"oauthClientId":"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com"}},"requestMetadata":{"callerIp":"111.237.127.135","callerSuppliedUserAgent":"FirebaseCLI/14.19.1,gzip(gfe),gzip(gfe)","requestAttributes":{"time":"2025-10-15T01:07:57.043949524Z","auth":{}},"destinationAttributes":{}},"serviceName":"cloudfunctions.googleapis.com","methodName":"google.cloud.functions.v2.FunctionService.UpdateFunction","authorizationInfo":[{"resource":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","permission":"cloudfunctions.functions.update","granted":true,"resourceAttributes":{"service":"cloudfunctions.googleapis.com","name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","type":"cloudfunctions.googleapis.com/Function"},"permissionType":"ADMIN_WRITE"}],"resourceName":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","request":{"@type":"type.googleapis.com/google.cloud.functions.v2.UpdateFunctionRequest","update_mask":{"paths":["name","build_config.runtime","build_config.entry_point","build_config.source.storage_source.bucket","build_config.source.storage_source.object","build_config.environment_variables","build_config.source_token","service_config.environment_variables","service_config.ingress_settings","service_config.timeout_seconds","service_config.service_account_email","service_config.available_memory","service_config.min_instance_count","service_config.max_instance_count","service_config.max_instance_request_concurrency","service_config.available_cpu","service_config.vpc_connector","service_config.vpc_connector_egress_settings","labels"]},"function":{"labels":{"firebase-functions-hash":"04544f31e3b515d8dd088351580f0d84954a05a2","deployment-tool":"cli-firebase"},"build_config":{"entry_point":"createCheckoutSession","source":{},"runtime":"nodejs22"},"service_config":{"available_memory":"256Mi","max_instance_request_concurrency":80,"available_cpu":"1"},"name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession"}},"response":{"@type":"type.googleapis.com/google.longrunning.Operation"},"resourceLocation":{"currentLocations":["us-central1"]}}
// 2025-10-15T01:08:49.811128Z I createcheckoutsession: Starting new instance. Reason: DEPLOYMENT_ROLLOUT - Instance started due to traffic shifting between revisions due to deployment, traffic split adjustment, or deployment health check.
// 2025-10-15T01:08:51.795030Z I createcheckoutsession: Default STARTUP TCP probe succeeded after 1 attempt for container "worker" on port 8080.      
// 2025-10-15T01:08:53.446229126Z N createCheckoutSession: {"@type":"type.googleapis.com/google.cloud.audit.AuditLog","status":{},"authenticationInfo":{"principalEmail":"ormomax@gmail.com","principalSubject":"user:ormomax@gmail.com","oauthInfo":{"oauthClientId":"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com"}},"requestMetadata":{"requestAttributes":{},"destinationAttributes":{}},"serviceName":"cloudfunctions.googleapis.com","methodName":"google.cloud.functions.v2.FunctionService.UpdateFunction","resourceName":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","response":{"satisfiesPzi":true,"state":"ACTIVE","@type":"type.googleapis.com/google.cloud.functions.v2.Function","name":"projects/genhorror-60/locations/us-central1/functions/createCheckoutSession","buildConfig":{"runtime":"nodejs22","dockerRegistry":"ARTIFACT_REGISTRY","automaticUpdatePolicy":{},"entryPoint":"createCheckoutSession","source":{},"dockerRepository":"projects/genhorror-60/locations/us-central1/repositories/gcf-artifacts","serviceAccount":"projects/genhorror-60/serviceAccounts/1003552555411-compute@developer.gserviceaccount.com"},"environment":"GEN_2","updateTime":"2025-10-15T01:07:57.979461325Z","labels":{"firebase-functions-hash":"04544f31e3b515d8dd088351580f0d84954a05a2","deployment-tool":"cli-firebase"},"createTime":"2025-10-14T13:39:01.011989987Z","url":"https://us-central1-genhorror-60.cloudfunctions.net/createCheckoutSession","serviceConfig":{"maxInstanceCount":20,"availableMemory":"256Mi","revision":"createcheckoutsession-00006-dib","maxInstanceRequestConcurrency":80,"availableCpu":"1","ingressSettings":"ALLOW_ALL","uri":"https://createcheckoutsession-4ttjamywha-uc.a.run.app","timeoutSeconds":60,"serviceAccountEmail":"1003552555411-compute@developer.gserviceaccount.com","allTrafficOnLatestRevision":true}},"resourceLocation":{"currentLocations":["us-central1"]}}
// 2025-10-15T01:18:16.925747Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 2025-10-15T01:21:05.991292Z W createcheckoutsession: The request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client
// 3. functions/package.json:
// {
//     "name": "functions",
//     "description": "Cloud Functions for Firebase",
//     "scripts": {
//       "serve": "firebase emulators:start --only functions",
//       "shell": "firebase functions:shell",
//       "start": "npm run shell",
//       "deploy": "firebase deploy --only functions",
//       "logs": "firebase functions:log"
//     },
//     "engines": {
//       "node": "22"
//     },
//     "main": "index.js",
//     "dependencies": {
//       "cors": "^2.8.5",
//       "firebase-admin": "^12.6.0",
//       "firebase-functions": "^6.0.1",
//       "stripe": "^14.0.0"
//     },
//     "devDependencies": {
//       "firebase-functions-test": "^3.1.0"
//     },
//     "private": true
//   }
//   4. 
//   一般
// 計費功能
// 以要求為依據
// 啟動時 CPU 效能強化
// 已啟用
// 並行
// 80
// 要求逾時
// 60 seconds
// 執行環境
// 預設
const response = await fetch("https://createcheckoutsession